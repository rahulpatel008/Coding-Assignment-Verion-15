<div class="dynamic-form" *ngIf="schema">
  <h2 *ngIf="schema.title">{{ schema.title }}</h2>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
    <ng-container *ngFor="let field of visibleFields">
      <div class="form-row" *ngIf="!field.hidden">
        <label [for]="field.name">{{ field.label }} <span *ngIf="field.required">*</span></label>

        <!-- Text input -->
        <input *ngIf="field.type === 'text'"
               [id]="field.name"
               [formControlName]="field.name"
               [attr.placeholder]="field.placeholder ?? ''"
               [readonly]="field.readonly ?? false" />

        <!-- Textarea -->
        <textarea *ngIf="field.type === 'textarea'"
                  [id]="field.name"
                  [formControlName]="field.name"
                  [attr.placeholder]="field.placeholder ?? ''"
                  [readonly]="field.readonly ?? false"></textarea>

        <!-- Date -->
        <input *ngIf="field.type === 'date'"
               type="date"
               [id]="field.name"
               [formControlName]="field.name"
               [readonly]="field.readonly ?? false" />

        <!-- Dropdown (single) -->
        <select *ngIf="field.type === 'dropdown'"
                [id]="field.name"
                [formControlName]="field.name"
                [attr.disabled]="null">
          <option value="">-- Select --</option>
          <option *ngFor="let opt of field.options" [value]="opt">{{ opt }}</option>
        </select>

        <!-- Multiselect (native) -->
        <select *ngIf="field.type === 'multiselect'"
                [id]="field.name"
                [formControlName]="field.name"
                multiple>
          <option *ngFor="let opt of field.options" [value]="opt">{{ opt }}</option>
        </select>

        <!-- Checkbox -->
        <input *ngIf="field.type === 'checkbox'"
               type="checkbox"
               [id]="field.name"
               [formControlName]="field.name" />

        <!-- Validation message -->
        <div class="error" *ngIf="getErrorMessage(field)">{{ getErrorMessage(field) }}</div>
      </div>
    </ng-container>

    <div class="form-actions">
      <button type="submit" [disabled]="form.invalid">Submit</button>
    </div>
  </form>
</div>
